<!DOCTYPE html><html lang="zh-CN" data-theme="light"><head><meta charset="UTF-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width,initial-scale=1"><title>2020_Filter Grafting | Fly-Pluche</title><meta name="description" content="滤波器嫁接技术：Code： https:&#x2F;&#x2F;github.com&#x2F;fxmeng&#x2F;filter-graftingPaper：https:&#x2F;&#x2F;arxiv.org&#x2F;pdf&#x2F;2001.05868.pdf 本文贡献：    提出了一种新的学习范式，称为滤波器嫁接。嫁接可以在不改变网络结构的情况下，重新激活无效的过滤器，提高神经网络的潜力。        提出了一种基于熵的准则和自适应加权策略，进一步提高了滤"><meta name="keywords" content="滤波器剪枝"><meta name="author" content="Fly-Pluche"><meta name="copyright" content="Fly-Pluche"><meta name="format-detection" content="telephone=no"><link rel="shortcut icon" href="/img/favicon.png"><link rel="canonical" href="http://yoursite.com/posts/2020_Filter_Grafting/"><meta http-equiv="Cache-Control" content="no-transform"><meta http-equiv="Cache-Control" content="no-siteapp"><link rel="preconnect" href="//cdn.jsdelivr.net"/><link rel="preconnect" href="//fonts.googleapis.com" crossorigin="crossorigin"/><link rel="preconnect" href="//busuanzi.ibruce.info"/><link rel="preconnect" href="//zz.bdstatic.com"/><meta property="og:type" content="article"><meta property="og:title" content="2020_Filter Grafting"><meta property="og:url" content="http://yoursite.com/posts/2020_Filter_Grafting/"><meta property="og:site_name" content="Fly-Pluche"><meta property="og:description" content="滤波器嫁接技术：Code： https:&#x2F;&#x2F;github.com&#x2F;fxmeng&#x2F;filter-graftingPaper：https:&#x2F;&#x2F;arxiv.org&#x2F;pdf&#x2F;2001.05868.pdf 本文贡献：    提出了一种新的学习范式，称为滤波器嫁接。嫁接可以在不改变网络结构的情况下，重新激活无效的过滤器，提高神经网络的潜力。        提出了一种基于熵的准则和自适应加权策略，进一步提高了滤"><meta property="og:image" content="https://cdn.jsdelivr.net/gh/HCLonely/hclonely.github.io/img/Butterfly/009.webp"><meta property="article:published_time" content="2021-05-17T10:22:44.000Z"><meta property="article:modified_time" content="2021-05-26T08:22:27.986Z"><meta name="twitter:card" content="summary"><script>var activateDarkMode = function () {
  document.documentElement.setAttribute('data-theme', 'dark')
  if (document.querySelector('meta[name="theme-color"]') !== null) {
    document.querySelector('meta[name="theme-color"]').setAttribute('content', '#000')
  }
}
var activateLightMode = function () {
  document.documentElement.setAttribute('data-theme', 'light')
  if (document.querySelector('meta[name="theme-color"]') !== null) {
    document.querySelector('meta[name="theme-color"]').setAttribute('content', '#fff')
  }
}

var getCookies = function (name) {
  const value = `; ${document.cookie}`
  const parts = value.split(`; ${name}=`)
  if (parts.length === 2) return parts.pop().split(';').shift()
}

var autoChangeMode = 'false'
var t = getCookies('theme')
if (autoChangeMode === '1') {
  var isDarkMode = window.matchMedia('(prefers-color-scheme: dark)').matches
  var isLightMode = window.matchMedia('(prefers-color-scheme: light)').matches
  var isNotSpecified = window.matchMedia('(prefers-color-scheme: no-preference)').matches
  var hasNoSupport = !isDarkMode && !isLightMode && !isNotSpecified

  if (t === undefined) {
    if (isLightMode) activateLightMode()
    else if (isDarkMode) activateDarkMode()
    else if (isNotSpecified || hasNoSupport) {
      console.log('You specified no preference for a color scheme or your browser does not support it. I Schedule dark mode during night time.')
      var now = new Date()
      var hour = now.getHours()
      var isNight = hour <= 6 || hour >= 18
      isNight ? activateDarkMode() : activateLightMode()
    }
    window.matchMedia('(prefers-color-scheme: dark)').addListener(function (e) {
      if (Cookies.get('theme') === undefined) {
        e.matches ? activateDarkMode() : activateLightMode()
      }
    })
  } else if (t === 'light') activateLightMode()
  else activateDarkMode()
} else if (autoChangeMode === '2') {
  now = new Date()
  hour = now.getHours()
  isNight = hour <= 6 || hour >= 18
  if (t === undefined) isNight ? activateDarkMode() : activateLightMode()
  else if (t === 'light') activateLightMode()
  else activateDarkMode()
} else {
  if (t === 'dark') activateDarkMode()
  else if (t === 'light') activateLightMode()
}</script><link rel="stylesheet" href="/css/index.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free/css/all.min.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fancyapps/fancybox@latest/dist/jquery.fancybox.min.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/node-snackbar/dist/snackbar.min.css"><link rel="prev" title="CVPR2021_Coordinate_Attention注意力机制" href="http://yoursite.com/posts/CVPR2021_Coordinate_Attention/"><link rel="next" title="canny边缘loss" href="http://yoursite.com/posts/canny_loss/"><link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Titillium+Web&amp;display=swap"><script>var GLOBAL_CONFIG = { 
  root: '/',
  algolia: undefined,
  localSearch: undefined,
  translate: {"defaultEncoding":2,"translateDelay":0,"msgToTraditionalChinese":"繁","msgToSimplifiedChinese":"簡"},
  noticeOutdate: {"limitDay":500,"position":"top","messagePrev":"It has been","messageNext":"days since the last update, the content of the article may be outdated."},
  copy: {
    success: '复制成功',
    error: '复制错误',
    noSupport: '浏览器不支持'
  },
  bookmark: {
    message_prev: '按',
    message_next: '键将本页加入书签'
  },
  runtime_unit: '天',
  runtime: false,
  copyright: {"languages":{"author":"作者: Fly-Pluche","link":"链接: ","source":"来源: Fly-Pluche","info":"著作权归作者所有。商业转载请联系作者获得授权，非商业转载请注明出处。"}},
  ClickShowText: undefined,
  medium_zoom: true,
  fancybox: true,
  Snackbar: {"bookmark":{"message_prev":"按","message_next":"键将本页加入书签"},"chs_to_cht":"你已切换为繁体","cht_to_chs":"你已切换为简体","day_to_night":"你已切换为深色模式","night_to_day":"你已切换为浅色模式","bgLight":"#49b1f5","bgDark":"#121212","position":"bottom-left"},
  justifiedGallery: {
    js: 'https://cdn.jsdelivr.net/npm/justifiedGallery/dist/js/jquery.justifiedGallery.min.js',
    css: 'https://cdn.jsdelivr.net/npm/justifiedGallery/dist/css/justifiedGallery.min.css'
  },
  baiduPush: true,
  highlightCopy: true,
  highlightLang: true,
  isPhotoFigcaption: false,
  islazyload: true,
  isanchor: true    
}</script><script>var GLOBAL_CONFIG_SITE = { 
  isPost: true,
  isHome: false,
  isHighlightShrink: false,
  isSidebar: true,
  postUpdate: '2021-05-26 16:22:27'
}</script><noscript><style>
#nav {
  opacity: 1
}
.justified-gallery img{
  opacity: 1
}
</style></noscript><link rel="stylesheet" href="https://cdn.jsdelivr.net/gh/sviptzk/HexoStaticFile@master/Hexo/css/flink.min.css"></head><body><div id="mobile-sidebar"><div id="menu_mask"></div><div id="mobile-sidebar-menus"><div class="mobile_author_icon"><img class="avatar-img" src="/img/Fly_Pluche.jpg" onerror="onerror=null;src='/img/friend_404.gif'" alt="avatar"/></div><div class="mobile_post_data"><div class="mobile_data_item is-center"><div class="mobile_data_link"><a href="/archives/"><div class="headline">文章</div><div class="length_num">12</div></a></div></div><div class="mobile_data_item is-center">      <div class="mobile_data_link"><a href="/tags/"><div class="headline">标签</div><div class="length_num">9</div></a></div></div><div class="mobile_data_item is-center">     <div class="mobile_data_link"><a href="/categories/"><div class="headline">分类</div><div class="length_num">13</div></a></div></div></div><hr/><div class="menus_items"><div class="menus_item"><a class="site-page" href="/"><i class="fa-fw fa fa-home"></i><span> 首页</span></a></div><div class="menus_item"><a class="site-page" href="/archives/"><i class="fa-fw fa fa-archive"></i><span> 时间轴</span></a></div><div class="menus_item"><a class="site-page" href="/tags/"><i class="fa-fw fa fa-tags"></i><span> 标签</span></a></div><div class="menus_item"><a class="site-page" href="/categories/"><i class="fa-fw fa fa-folder-open"></i><span> 分类</span></a></div><div class="menus_item"><a class="site-page"><i class="fa-fw fas fa-list"></i><span> 媒体</span><i class="fas fa-chevron-down menus-expand"></i></a><ul class="menus_item_child"><li><a class="site-page" href="/bangumis/"><i class="fa-fw fab fa-youtube"></i><span> 番剧</span></a></li><li><a class="site-page" href="/movies/"><i class="fa-fw fa fa-film"></i><span> 电影</span></a></li><li><a class="site-page" href="/books/"><i class="fa-fw fas fa-book"></i><span> 书单</span></a></li><li><a class="site-page" href="/music/"><i class="fa-fw fa fa-music"></i><span> 音乐</span></a></li></ul></div><div class="menus_item"><a class="site-page" href="/box/"><i class="fa-fw fab fa-xbox"></i><span> 聚宝盒</span></a></div><div class="menus_item"><a class="site-page" href="/talk/"><i class="fa-fw far fa-comment"></i><span> 微语</span></a></div><div class="menus_item"><a class="site-page"><i class="fa-fw fa fa-heartbeat"></i><span> 清单</span><i class="fas fa-chevron-down menus-expand"></i></a><ul class="menus_item_child"><li><a class="site-page" href="/gallery/"><i class="fa-fw far fa-image"></i><span> 相册</span></a></li><li><a class="site-page" href="/home/"><i class="fa-fw fab fa-phoenix-framework"></i><span> 主页</span></a></li></ul></div><div class="menus_item"><a class="site-page" href="/contact/"><i class="fa-fw far fa-comments"></i><span> 留言板</span></a></div><div class="menus_item"><a class="site-page" href="/link/"><i class="fa-fw fa fa-link"></i><span> 友链</span></a></div><div class="menus_item"><a class="site-page" href="/about/"><i class="fa-fw fa fa-heart"></i><span> 关于</span></a></div></div></div></div><i class="fas fa-arrow-right on" id="toggle-sidebar"></i><div id="sidebar"><div class="sidebar-toc"><div class="sidebar-toc__title">目录</div><div class="sidebar-toc__progress"><span class="progress-notice">你已经读了</span><span class="progress-num">0</span><span class="progress-percentage">%</span><div class="sidebar-toc__progress-bar">     </div></div><div class="sidebar-toc__content"><ol class="toc"><li class="toc-item toc-level-1"><a class="toc-link" href="#滤波器嫁接技术："><span class="toc-number">1.</span> <span class="toc-text">滤波器嫁接技术：</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#1-滤波器嫁接动机"><span class="toc-number">1.0.1.</span> <span class="toc-text">1.滤波器嫁接动机</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#2-嫁接与裁剪，蒸馏的区别："><span class="toc-number">1.0.2.</span> <span class="toc-text">2.嫁接与裁剪，蒸馏的区别：</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#3-如何计算滤波器的重要性"><span class="toc-number">1.0.3.</span> <span class="toc-text">3.如何计算滤波器的重要性</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#L1范数（L1-norm）："><span class="toc-number">1.0.3.1.</span> <span class="toc-text">L1范数（L1 norm）：</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#熵："><span class="toc-number">1.0.3.2.</span> <span class="toc-text">熵：</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#4-滤波器嫁接详解"><span class="toc-number">1.0.4.</span> <span class="toc-text">4.滤波器嫁接详解</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#（1）噪声作为接穗"><span class="toc-number">1.0.4.1.</span> <span class="toc-text">（1）噪声作为接穗</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#2）内部滤波器作为接穗"><span class="toc-number">1.0.4.2.</span> <span class="toc-text">2）内部滤波器作为接穗</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#3）外部滤波器作为接穗"><span class="toc-number">1.0.4.3.</span> <span class="toc-text">3）外部滤波器作为接穗</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#5-结果分析："><span class="toc-number">1.0.5.</span> <span class="toc-text">5.结果分析：</span></a></li></ol></li></ol></li></ol></div></div></div><div id="body-wrap"><div id="web_bg" data-type="photo"></div><header class="post-bg" id="page-header" style="background-image: url(https://cdn.jsdelivr.net/gh/HCLonely/hclonely.github.io/img/Butterfly/009.webp)"><nav id="nav"><span class="pull-left" id="blog_name"><a class="blog_title" id="site-name" href="/">Fly-Pluche</a></span><span class="pull-right menus"><div class="menus_items"><div class="menus_item"><a class="site-page" href="/"><i class="fa-fw fa fa-home"></i><span> 首页</span></a></div><div class="menus_item"><a class="site-page" href="/archives/"><i class="fa-fw fa fa-archive"></i><span> 时间轴</span></a></div><div class="menus_item"><a class="site-page" href="/tags/"><i class="fa-fw fa fa-tags"></i><span> 标签</span></a></div><div class="menus_item"><a class="site-page" href="/categories/"><i class="fa-fw fa fa-folder-open"></i><span> 分类</span></a></div><div class="menus_item"><a class="site-page"><i class="fa-fw fas fa-list"></i><span> 媒体</span><i class="fas fa-chevron-down menus-expand"></i></a><ul class="menus_item_child"><li><a class="site-page" href="/bangumis/"><i class="fa-fw fab fa-youtube"></i><span> 番剧</span></a></li><li><a class="site-page" href="/movies/"><i class="fa-fw fa fa-film"></i><span> 电影</span></a></li><li><a class="site-page" href="/books/"><i class="fa-fw fas fa-book"></i><span> 书单</span></a></li><li><a class="site-page" href="/music/"><i class="fa-fw fa fa-music"></i><span> 音乐</span></a></li></ul></div><div class="menus_item"><a class="site-page" href="/box/"><i class="fa-fw fab fa-xbox"></i><span> 聚宝盒</span></a></div><div class="menus_item"><a class="site-page" href="/talk/"><i class="fa-fw far fa-comment"></i><span> 微语</span></a></div><div class="menus_item"><a class="site-page"><i class="fa-fw fa fa-heartbeat"></i><span> 清单</span><i class="fas fa-chevron-down menus-expand"></i></a><ul class="menus_item_child"><li><a class="site-page" href="/gallery/"><i class="fa-fw far fa-image"></i><span> 相册</span></a></li><li><a class="site-page" href="/home/"><i class="fa-fw fab fa-phoenix-framework"></i><span> 主页</span></a></li></ul></div><div class="menus_item"><a class="site-page" href="/contact/"><i class="fa-fw far fa-comments"></i><span> 留言板</span></a></div><div class="menus_item"><a class="site-page" href="/link/"><i class="fa-fw fa fa-link"></i><span> 友链</span></a></div><div class="menus_item"><a class="site-page" href="/about/"><i class="fa-fw fa fa-heart"></i><span> 关于</span></a></div></div><span class="toggle-menu close"><a class="site-page"><i class="fas fa-bars fa-fw"></i></a></span></span></nav><div id="post-info"><div id="post-title"><div class="posttitle">2020_Filter Grafting</div></div><div id="post-meta"><div class="meta-firstline"><time class="post-meta__date"><span class="post-meta__date-created" title="发表于 2021-05-17 18:22:44"><i class="far fa-calendar-alt fa-fw"></i> 发表于 2021-05-17</span><span class="post-meta__separator">|</span><span class="post-meta__date-updated" title="更新于 2021-05-26 16:22:27"><i class="fas fa-history fa-fw"></i> 更新于 2021-05-26</span></time><span class="post-meta__categories"><span class="post-meta__separator">|</span><i class="fas fa-inbox fa-fw post-meta__icon"></i><a class="post-meta__categories" href="/categories/Paper/">Paper</a><i class="fas fa-angle-right post-meta__separator"></i><i class="fas fa-inbox fa-fw post-meta__icon"></i><a class="post-meta__categories" href="/categories/Paper/cv/">cv</a><i class="fas fa-angle-right post-meta__separator"></i><i class="fas fa-inbox fa-fw post-meta__icon"></i><a class="post-meta__categories" href="/categories/Paper/cv/%E6%A8%A1%E5%9E%8B%E5%8E%8B%E7%BC%A9/">模型压缩</a></span></div><div class="meta-secondline"> </div><div class="meta-thirdline"><span class="post-meta-pv-cv"><i class="far fa-eye fa-fw post-meta__icon"></i><span>阅读量:</span><span id="busuanzi_value_page_pv"></span></span></div></div></div></header><main class="layout_post" id="content-inner"><article id="post"><div class="post-content" id="article-container"><h1 id="滤波器嫁接技术："><a href="#滤波器嫁接技术：" class="headerlink" title="滤波器嫁接技术："></a>滤波器嫁接技术：</h1><p>Code： <a href="https://github.com/fxmeng/filter-grafting" target="_blank" rel="noopener">https://github.com/fxmeng/filter-grafting</a><br>Paper：<a href="https://arxiv.org/pdf/2001.05868.pdf" target="_blank" rel="noopener">https://arxiv.org/pdf/2001.05868.pdf</a></p>
<p>本文贡献：<br>    提出了一种新的学习范式，称为滤波器嫁接。嫁接可以在不改变网络结构的情况下，重新激活无效的过滤器，提高神经网络的潜力。<br>        提出了一种基于熵的准则和自适应加权策略，进一步提高了滤波器嫁接方法的性能。</p>
<h3 id="1-滤波器嫁接动机"><a href="#1-滤波器嫁接动机" class="headerlink" title="1.滤波器嫁接动机"></a>1.滤波器嫁接动机</h3><p> 构建滤波器嫁接技术的动机是通常在训练完的网络中存在一些无效的滤波器，很多网络模型剪枝的文献中就会把这些无效的滤波器剪切掉。 但是，这些看似无效的滤波器不一定是真的无效的，比如在集成学习中，当单个弱分类器效果差时，它们的组合反而会得到更强的性能。这说明无效的滤波器是可以被激活的，而本文考虑重新激活这些无效滤波器，在不增加模型推理时间的前提下，有效提升网络性能。</p>
<h3 id="2-嫁接与裁剪，蒸馏的区别："><a href="#2-嫁接与裁剪，蒸馏的区别：" class="headerlink" title="2.嫁接与裁剪，蒸馏的区别："></a>2.嫁接与裁剪，蒸馏的区别：</h3><p> 在这里插入图片描述<br><img src= "/img/loading.gif" data-src="https://img-blog.csdnimg.cn/20210228123910537.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3FxXzUxMzAyNTY0,size_16,color_FFFFFF,t_70" alt="在这里插入图片描述"></p>
<p>所谓的激活就是通过将外部信息移植到到这些无效滤波器中，该过程被定义为滤波器嫁接。滤波器嫁接的关键是选择合适的信息源</p>
<p>嫁接可能涉及并行地训练多个网络。因此，这个过程类似于蒸馏学习。嫁接和蒸馏的区别在于，蒸馏是一个两阶段的过程。首先，我们需要训练一个大模型(老师)，然后使用训练好的大模型来教一个小模型(学生)。而嫁接是一个单阶段的过程，在训练过程中进行滤波器嫁接。（优于传统蒸馏学习等方法）<br><img src= "/img/loading.gif" data-src="https://img-blog.csdnimg.cn/20210228124034315.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3FxXzUxMzAyNTY0,size_16,color_FFFFFF,t_70" alt="在这里插入图片描述"></p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">if</span> __name__ == <span class="string">'__main__'</span>:</span><br><span class="line">    <span class="keyword">for</span> epoch <span class="keyword">in</span> range(start_epoch, args.epochs):</span><br><span class="line">        train(epoch)</span><br><span class="line">        test(epoch)</span><br><span class="line">        state = &#123;</span><br><span class="line">            <span class="string">'net'</span>: net.state_dict(),</span><br><span class="line">        &#125;</span><br><span class="line">        torch.save(state, <span class="string">'%s/ckpt%d_%d.t7'</span> % (args.s, args.i % args.num, epoch))</span><br><span class="line">        grafting(net, epoch)</span><br></pre></td></tr></table></figure>
<h3 id="3-如何计算滤波器的重要性"><a href="#3-如何计算滤波器的重要性" class="headerlink" title="3.如何计算滤波器的重要性"></a>3.如何计算滤波器的重要性</h3><p>通常情况下多数裁剪文献中都利用L1范数来评价滤波器的重要性</p>
<h4 id="L1范数（L1-norm）："><a href="#L1范数（L1-norm）：" class="headerlink" title="L1范数（L1 norm）："></a>L1范数（L1 norm）：</h4><p>如下公式所示，以一层滤波器为单位，L1范数的计算就是将当前层滤波器中所有的卷积层参数进行逐点求绝对值并求和。现有的文献中普遍认为L1范数越接近零，当前滤波器越不重要。但最近的研究表明，更小更不重要的标准并不总是正确的。一个特殊的情况是，一个权重分布在 0–1之间的滤波器肯定比所有权重都为1的滤波器更好。很显然，L1范数准则只关注滤波器权值的绝对值，并没有关注权值的变化。因此利用L1范数评价滤波器的好坏是不全面的。<br><img src= "/img/loading.gif" data-src="https://img-blog.csdnimg.cn/20210228124044454.png" alt="在这里插入图片描述"></p>
<h4 id="熵："><a href="#熵：" class="headerlink" title="熵："></a>熵：</h4><p>先概述一下计算过程。<br>分析了L1范数的利弊，我们发现用L1范数，滤波器不能区分输入的哪一部分更重要。所以我们选择测量权重的变化。本文提出了熵的形式来衡量滤波器权重的变化程度，以此为依据来判别滤波器的好坏。具体来说，计算熵的方法为将滤波器权重按照大小等分为离散的几个区间，并计算区间对应的概率，最后利用熵的公式计算整个滤波器的熵。如公式4，5结合起来，首先计算一层滤波器中一个卷积层的熵，并求和。公式6表示直接将当前层的滤波器进行权重划分后计算熵。<br><img src= "/img/loading.gif" data-src="https://img-blog.csdnimg.cn/20210228124050947.png" alt="在这里插入图片描述"></p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">entropy</span><span class="params">(x, n=<span class="number">10</span>)</span>:</span></span><br><span class="line">    x = x.reshape(<span class="number">-1</span>)</span><br><span class="line">    scale = (x.max() - x.min()) / n</span><br><span class="line">    entropy = <span class="number">0</span></span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> range(n):</span><br><span class="line">        p = torch.sum((x &gt;= x.min() + i * scale) * (x &lt; x.min() + (i + <span class="number">1</span>) * scale), dtype=torch.float) / len(x)</span><br><span class="line">        <span class="keyword">if</span> p != <span class="number">0</span>:</span><br><span class="line">            entropy -= p * torch.log(p)</span><br><span class="line">    <span class="keyword">return</span> float(entropy.cpu())</span><br></pre></td></tr></table></figure>
<p>下面我们依次对三个公式进行讲解：<br><img src= "/img/loading.gif" data-src="https://img-blog.csdnimg.cn/20210228124056968.png" alt="在这里插入图片描述"></p>
<p>把滤波器的权重分为m个等大小的范围如：<br>        0<del>0.1  的大小是一个范围，   0.8</del>0.9的大小是另一个范围。</p>
<p>计算每个范围中所含权重的个数占所有权重的比例如：<br> 设一共有B个权重数据，有3个权重的大小刚好在0~0.1这个范围，那么这个时候Pk=3/B(这里的B与Pk与公式中的字母相对应）</p>
<p>如果滤波器的权重变化越小，Pk越小，则结果越小<br><img src= "/img/loading.gif" data-src="https://img-blog.csdnimg.cn/20210228124215182.png" alt="在这里插入图片描述"></p>
<p>假设第i层有C个滤波器，那么第i层的总信息为（5）的计算结果（换个表达，把第i层中的C个滤波器的的信息加起来就可以得到该层的全部信息）<br><img src= "/img/loading.gif" data-src="https://img-blog.csdnimg.cn/20210228124226826.png" alt="在这里插入图片描述"></p>
<p>接下来就是要把每个层的信息进行关联，<br>我们采用与（4）相同的函数进行计算，与(4)不同的是，(6)中的值来自于整个层的权值，而不是单个过滤器。</p>
<h3 id="4-滤波器嫁接详解"><a href="#4-滤波器嫁接详解" class="headerlink" title="4.滤波器嫁接详解"></a>4.滤波器嫁接详解</h3><h4 id="（1）噪声作为接穗"><a href="#（1）噪声作为接穗" class="headerlink" title="（1）噪声作为接穗"></a>（1）噪声作为接穗</h4><p>文章中作者将原始网络中无效的滤波器称为砧木，将有意义的滤波器称为接穗，这与嫁接的植物学解释是一致的。滤波器嫁接的目的是将信息(权重)从接穗转移到砧木，因此选择有用的信息是嫁接的关键。在本文中，作者提出了三种获取接穗的方法。</p>
<p>噪声作为接穗：利用均值为0，方差为delta的高斯噪声作为接穗，使得L1范数很小的无效滤波器变得更有效。<br><img src= "/img/loading.gif" data-src="https://img-blog.csdnimg.cn/20210228124239734.png" alt="在这里插入图片描述"></p>
<p>当然随着迭代次数的增加，需要适当降低高斯噪声方差的值<img src= "/img/loading.gif" data-src="https://img-blog.csdnimg.cn/20210228124250549.png" alt="在这里插入图片描述">，因为过大的方差会导致网络难以收敛。</p>
<h4 id="2）内部滤波器作为接穗"><a href="#2）内部滤波器作为接穗" class="headerlink" title="2）内部滤波器作为接穗"></a>2）内部滤波器作为接穗</h4><p>我觉的可以直接从图中看出一个大概：<br><img src= "/img/loading.gif" data-src="https://img-blog.csdnimg.cn/20210228124312547.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3FxXzUxMzAyNTY0,size_16,color_FFFFFF,t_70" alt="在这里插入图片描述"></p>
<p> 先计算熵值，然后按大小进行排序，接着对熵低于自己设定的阈值的通道i 将第i个熵值最大滤波器的权值移入第i个熵值最小滤波器( 滤波器的熵值小于γ，则认为这些滤波器是无效的)。由于这种嫁接技术发生在网络内部，因此无法增加额外的信息。</p>
<h4 id="3）外部滤波器作为接穗"><a href="#3）外部滤波器作为接穗" class="headerlink" title="3）外部滤波器作为接穗"></a>3）外部滤波器作为接穗</h4><p>外部滤波器作为接穗：针对在单一网络中加入随机噪声和权值的缺点，可以从其他网络中选择外部滤波器作为接穗。具体来说，可以并行地训练两个网络(也可训练多个，这里先将两个的网络），分别记作M1和M2。在每个epoch的训练中，我们将M1的有效滤波器权值嫁接到M2的无效滤波器中。该过程中的嫁接发生在层级，而不是滤波器级，这意味着我们将M1中某一层中所有滤波器权重嫁接到同一层的M2中。（按我个人的理解，这两个网络应该是同一个网络，只是超参数的设置不同。欢迎有其他见解的人指出！）<br><img src= "/img/loading.gif" data-src="https://img-blog.csdnimg.cn/20210228124337973.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3FxXzUxMzAyNTY0,size_16,color_FFFFFF,t_70" alt="在这里插入图片描述"></p>
<p>在进行嫁接时，具体的操作如下公式所示，通过对接穗和砧木的权重进行加权后，得到最终的嫁接参数。其中阿尔法值要大于0.5，因为接穗的权重更有效。<br>（函数解析在图片后面哦 ）<br><img src= "/img/loading.gif" data-src="https://img-blog.csdnimg.cn/2021022812434418.png" alt="在这里插入图片描述"><br><img src= "/img/loading.gif" data-src="https://img-blog.csdnimg.cn/20210228124350641.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3FxXzUxMzAyNTY0,size_16,color_FFFFFF,t_70" alt="在这里插入图片描述"></p>
<p>这里的权重系数阿拉法：<br>第一：当M2的熵值和M1的熵值相同时，阿尔法的值为0.5；当M2的熵值大于M1的熵值时，阿尔法的值大于0.5。<br>第二：即使M2的熵值和M1的熵值相差非常大的情况下，阿尔法的值也不能是0或无穷。<br><img src= "/img/loading.gif" data-src="https://img-blog.csdnimg.cn/20210228124401620.png" alt="在这里插入图片描述"></p>
<p>arctan函数（‘s形’，感觉可以理解为sigmoid函数的用法）把<img src= "/img/loading.gif" data-src="https://img-blog.csdnimg.cn/20210228124407730.png" alt="在这里插入图片描述"><br>进行压缩，然后乘一个比例系数再加上0.5</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">grafting</span><span class="params">(net, epoch)</span>:</span></span><br><span class="line">    <span class="keyword">while</span> <span class="literal">True</span>:</span><br><span class="line">        <span class="keyword">try</span>:</span><br><span class="line">            checkpoint = torch.load(<span class="string">'%s/ckpt%d_%d.t7'</span> % (args.s, args.i - <span class="number">1</span>, epoch))[<span class="string">'net'</span>]</span><br><span class="line">            <span class="keyword">break</span></span><br><span class="line">        <span class="keyword">except</span>:</span><br><span class="line">            time.sleep(<span class="number">10</span>)</span><br><span class="line">    model = collections.OrderedDict()</span><br><span class="line">    <span class="keyword">for</span> i, (key, u) <span class="keyword">in</span> enumerate(net.state_dict().items()):</span><br><span class="line">        <span class="keyword">if</span> <span class="string">'conv'</span> <span class="keyword">in</span> key:</span><br><span class="line">            w = round(args.a / np.pi * np.arctan(args.c * (entropy(u) - entropy(checkpoint[key]))) + <span class="number">0.5</span>, <span class="number">2</span>)</span><br><span class="line">        model[key] = u * w + checkpoint[key] * (<span class="number">1</span> - w)</span><br><span class="line">    net.load_state_dict(model)</span><br></pre></td></tr></table></figure>
<p>好了，看了这么多，我相信聪明的你应该能一眼就理解多个网络相互嫁接的思路☺：</p>
<p><img src= "/img/loading.gif" data-src="https://img-blog.csdnimg.cn/20210228125930217.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3FxXzUxMzAyNTY0,size_16,color_FFFFFF,t_70" alt="在这里插入图片描述"></p>
<h3 id="5-结果分析："><a href="#5-结果分析：" class="headerlink" title="5.结果分析："></a>5.结果分析：</h3><p>很明显利用外部滤波器嫁接得到了最好的性能：<br><img src= "/img/loading.gif" data-src="https://img-blog.csdnimg.cn/20210228124420828.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3FxXzUxMzAyNTY0,size_16,color_FFFFFF,t_70" alt="在这里插入图片描述"></p>
<p>下表展示了利用L1范数和熵值两种指标评价滤波器好坏后，嫁接策略的性能。从结果中可以看出，利用熵值有更好的性能，进一步说明了熵值是一种更优秀的评价滤波器好坏的准则。<br><img src= "/img/loading.gif" data-src="https://img-blog.csdnimg.cn/20210228124428733.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3FxXzUxMzAyNTY0,size_16,color_FFFFFF,t_70" alt="在这里插入图片描述"></p>
<p>下表展示了由于嫁接是模型间的权值传递，当外部信息(权值)变化较大时，网络能够更好地学习。抽样顺序和学习率带来的权重变化丰富了嫁接信息，从而鼓励模型更好地学习。另外，在进行嫁接时，所有网络在数据加载器和学习速率方面使用不同的超参数。<br><img src= "/img/loading.gif" data-src="https://img-blog.csdnimg.cn/2021022812443521.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3FxXzUxMzAyNTY0,size_16,color_FFFFFF,t_70" alt="在这里插入图片描述"></p>
<p>下表展示了嫁接策略对模型最终结果的增益优于传统的蒸馏学习等方法，体现了嫁接策略的有效性<br><img src= "/img/loading.gif" data-src="https://img-blog.csdnimg.cn/20210228124441955.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3FxXzUxMzAyNTY0,size_16,color_FFFFFF,t_70" alt="在这里插入图片描述"></p>
<p>最终作者还对嫁接后的模型进行了滤波器有效性分析，进一步证明了嫁接策略的有效性。很明显，经过嫁接策略后无效滤波器的数量显著减少。<br><img src= "/img/loading.gif" data-src="https://img-blog.csdnimg.cn/20210228124450228.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3FxXzUxMzAyNTY0,size_16,color_FFFFFF,t_70" alt="在这里插入图片描述"></p>
<p>原文CSDN讲解：<a href="https://blog.csdn.net/qiu931110/article/details/104732821" target="_blank" rel="noopener">https://blog.csdn.net/qiu931110/article/details/104732821</a></p>
</div><div class="post-copyright"><div class="post-copyright__author"><span class="post-copyright-meta">文章作者: </span><span class="post-copyright-info"><a href="mailto:undefined">Fly-Pluche</a></span></div><div class="post-copyright__type"><span class="post-copyright-meta">文章链接: </span><span class="post-copyright-info"><a href="http://yoursite.com/posts/2020_Filter_Grafting/">http://yoursite.com/posts/2020_Filter_Grafting/</a></span></div><div class="post-copyright__notice"><span class="post-copyright-meta">版权声明: </span><span class="post-copyright-info">本博客所有文章除特别声明外，均采用 <a href="https://Fly-Pluche.github.io" target="_blank">CC BY-NC-SA 4.0</a> 许可协议。转载请注明来自 <a href="http://yoursite.com" target="_blank">Fly-Pluche</a>！</span></div></div><div class="tag_share"><div class="post-meta__tag-list"><a class="post-meta__tags" href="/tags/%E7%AC%94%E8%AE%B0/">笔记</a><a class="post-meta__tags" href="/tags/Paper/">Paper</a><a class="post-meta__tags" href="/tags/prune/">prune</a></div><div class="post_share"><div class="social-share" data-image="https://cdn.jsdelivr.net/gh/HCLonely/hclonely.github.io/img/Butterfly/013.webp" data-sites="facebook,twitter,wechat,weibo,qq"></div><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/social-share.js/dist/css/share.min.css"/><script src="https://cdn.jsdelivr.net/npm/social-share.js/dist/js/social-share.min.js"></script></div></div><div class="post-reward"><button class="reward-button" type="button"><i class="fas fa-qrcode"></i> 打赏<div class="reward-main"><ul class="reward-all"><li class="reward-item"><img class="post-qr-code__img" src="/img/wechat.png" alt="wechat" onclick="window.open('/img/wechat.png')"/><div class="post-qr-code__desc">wechat</div></li><li class="reward-item"><img class="post-qr-code__img" src="/img/alipay.jpg" alt="alipay" onclick="window.open('/img/alipay.jpg')"/><div class="post-qr-code__desc">alipay</div></li><li class="reward-item"><img class="post-qr-code__img" src="/img/qq.png" alt="qq" onclick="window.open('/img/qq.png')"/><div class="post-qr-code__desc">qq</div></li></ul></div></button></div><nav class="pagination-post" id="pagination"><div class="prev-post pull-left"><a href="/posts/CVPR2021_Coordinate_Attention/"><img class="prev-cover" data-src="https://cdn.jsdelivr.net/gh/HCLonely/hclonely.github.io/img/Butterfly/012.webp" onerror="onerror=null;src='/img/404.jpg'"><div class="pagination-info"><div class="label">上一篇</div><div class="prev_info">CVPR2021_Coordinate_Attention注意力机制</div></div></a></div><div class="next-post pull-right"><a href="/posts/canny_loss/"><img class="next-cover" data-src="https://cdn.jsdelivr.net/gh/HCLonely/hclonely.github.io/img/Butterfly/011.webp" onerror="onerror=null;src='/img/404.jpg'"><div class="pagination-info"><div class="label">下一篇</div><div class="next_info">canny边缘loss</div></div></a></div></nav><div class="relatedPosts"><div class="relatedPosts_headline"><i class="fas fa-thumbs-up fa-fw"></i><span> 相关推荐</span></div><div class="relatedPosts_list"><div class="relatedPosts_item"><a href="/posts/IoU_loss/" title="IoU loss"><img class="relatedPosts_cover" data-src="https://cdn.jsdelivr.net/gh/HCLonely/hclonely.github.io/img/Butterfly/013.webp"><div class="relatedPosts_main is-center"><div class="relatedPosts_date"><i class="far fa-calendar-alt fa-fw"></i> 2021-05-17</div><div class="relatedPosts_title">IoU loss</div></div></a></div><div class="relatedPosts_item"><a href="/posts/2017_Slimming_pytorch/" title="2017_Slimming_pytorch"><img class="relatedPosts_cover" data-src="https://cdn.jsdelivr.net/gh/HCLonely/hclonely.github.io/img/Butterfly/010.webp"><div class="relatedPosts_main is-center"><div class="relatedPosts_date"><i class="far fa-calendar-alt fa-fw"></i> 2021-05-17</div><div class="relatedPosts_title">2017_Slimming_pytorch</div></div></a></div><div class="relatedPosts_item"><a href="/posts/CVPR2021_Coordinate_Attention/" title="CVPR2021_Coordinate_Attention注意力机制"><img class="relatedPosts_cover" data-src="https://cdn.jsdelivr.net/gh/HCLonely/hclonely.github.io/img/Butterfly/012.webp"><div class="relatedPosts_main is-center"><div class="relatedPosts_date"><i class="far fa-calendar-alt fa-fw"></i> 2021-05-17</div><div class="relatedPosts_title">CVPR2021_Coordinate_Attention注意力机制</div></div></a></div><div class="relatedPosts_item"><a href="/posts/canny_loss/" title="canny边缘loss"><img class="relatedPosts_cover" data-src="https://cdn.jsdelivr.net/gh/HCLonely/hclonely.github.io/img/Butterfly/011.webp"><div class="relatedPosts_main is-center"><div class="relatedPosts_date"><i class="far fa-calendar-alt fa-fw"></i> 2021-05-17</div><div class="relatedPosts_title">canny边缘loss</div></div></a></div><div class="relatedPosts_item"><a href="/posts/PointRend/" title="PointRend"><img class="relatedPosts_cover" data-src="https://cdn.jsdelivr.net/gh/HCLonely/hclonely.github.io/img/Butterfly/007.webp"><div class="relatedPosts_main is-center"><div class="relatedPosts_date"><i class="far fa-calendar-alt fa-fw"></i> 2021-05-17</div><div class="relatedPosts_title">PointRend</div></div></a></div><div class="relatedPosts_item"><a href="/posts/Englishwords/" title="阅读论文常见的英语单词"><img class="relatedPosts_cover" data-src="https://cdn.jsdelivr.net/gh/HCLonely/hclonely.github.io/img/Butterfly/008.webp"><div class="relatedPosts_main is-center"><div class="relatedPosts_date"><i class="far fa-calendar-alt fa-fw"></i> 2021-05-17</div><div class="relatedPosts_title">阅读论文常见的英语单词</div></div></a></div></div></div></article></main><footer id="footer" data-type="color"><div id="footer-wrap"><div class="copyright">&copy;2021  <i id="heartbeat" class="fa fas fa-heartbeat"></i> Fly-Pluche</div><div class="framework-info"><span>驱动 </span><a href="https://hexo.io" target="_blank" rel="noopener"><span>Hexo</span></a><span class="footer-separator">|</span><span>主题 </span><a href="https://github.com/jerryc127/hexo-theme-butterfly" target="_blank" rel="noopener"><span>Butterfly</span></a></div><div class="footer_custom_text">Hi, welcome to my <a href="http://fly-pluche.github.io//" target="_blank" rel="noopener">blog</a>!</div></div><head><link rel="stylesheet" href="https://cdn.jsdelivr.net/gh/HCLonely/images@master/others/heartbeat.min.css"><meta name="generator" content="Hexo 4.2.1"></head></footer></div><section id="rightside"><div id="rightside-config-hide"><button id="readmode" type="button" title="阅读模式"><i class="fas fa-book-open"></i></button><button id="font_plus" type="button" title="放大字体"><i class="fas fa-plus"></i></button><button id="font_minus" type="button" title="缩小字体"><i class="fas fa-minus"></i></button><button id="translateLink" type="button" title="简繁转换">繁</button><button id="darkmode" type="button" title="浅色和深色模式转换"><i class="fas fa-adjust"></i></button></div><div id="rightside-config-show"><button id="rightside_config" type="button" title="设置"><i class="fas fa-cog"></i></button><button class="close" id="mobile-toc-button" type="button" title="目录"><i class="fas fa-list-ul"></i></button><button id="go-up" type="button" title="回到顶部"><i class="fas fa-arrow-up"></i></button></div></section><script src="https://cdn.jsdelivr.net/npm/jquery@latest/dist/jquery.min.js"></script><script src="/js/utils.js"></script><script src="/js/main.js"></script><script src="/js/tw_cn.js"></script><script src="https://cdn.jsdelivr.net/npm/medium-zoom/dist/medium-zoom.min.js"></script><script src="https://cdn.jsdelivr.net/npm/@fancyapps/fancybox@latest/dist/jquery.fancybox.min.js"></script><script src="https://cdn.jsdelivr.net/npm/node-snackbar/dist/snackbar.min.js"></script><script async src="//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script><script src="https://cdn.jsdelivr.net/npm/instant.page/instantpage.min.js" type="module" defer></script><script src="https://cdn.jsdelivr.net/npm/vanilla-lazyload/dist/lazyload.iife.min.js" async></script><script src="/js/calendar.js"></script><script src="/js/languages.js"></script><script src="/live2dw/lib/L2Dwidget.min.js?094cbace49a39548bed64abff5988b05"></script><script>L2Dwidget.init({"model":{"jsonPath":"/live2dw/assets/haruto.model.json"},"display":{"position":"right","width":120,"height":260},"mobile":{"show":false},"log":false,"pluginJsPath":"lib/","pluginModelPath":"assets/","pluginRootPath":"live2dw/","tagMode":false});</script></body></html>